<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>会议出租率看板</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", sans-serif;
      background: #f5f7fa;
      color: #333;
      padding: 16px;
    }
    .container {
      max-width: 100%;
      margin: 0 auto;
    }
    header {
      text-align: center;
      margin-bottom: 16px;
    }
    h1 {
      font-size: 20px;
      font-weight: 600;
    }

    /* 日历头部 */
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding: 0 8px;
    }
    .month-title {
      font-size: 18px;
      font-weight: bold;
    }
    .nav-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: #e0e0e0;
      border-radius: 50%;
      font-weight: bold;
      cursor: pointer;
    }

    /* 星期标题 */
    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
    }

    /* 日期网格 */
    .days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }
    .day-cell {
      aspect-ratio: 1;
      background: white;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 4px;
      font-size: 14px;
      position: relative;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .day-number {
      margin-bottom: 4px;
      font-weight: bold;
    }
    .other-month {
      color: #ccc;
      background: #f9f9f9;
    }
    .today {
      background: #e6f7ff;
      border: 1px solid #1890ff;
    }

    /* 出租率标签 */
    .rate-tag {
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 12px;
      margin: 2px 0;
      cursor: pointer;
      text-align: center;
      width: 100%;
    }
    .own-hotel { background: #f0f9eb; color: #006b3f; }
    .competitor { background: #eef5ff; color: #0050b3; }
    .business { background: #fdf6ec; color: #cc8400; }

    /* 弹窗 */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
    }
    .modal-content {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: white;
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
      padding: 20px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .close-btn {
      font-size: 24px;
      cursor: pointer;
    }
    .detail-item {
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }
    .detail-item:last-child {
      border-bottom: none;
    }
    .hotel-name {
      font-weight: bold;
      margin-bottom: 4px;
    }
    .activity-list {
      font-size: 14px;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>会议出租率看板</h1>
    </header>

    <!-- 日历 -->
    <div class="calendar">
      <div class="calendar-header">
        <button class="nav-btn" id="prevMonth">&lt;</button>
        <div class="month-title" id="currentMonth">2026年1月</div>
        <button class="nav-btn" id="nextMonth">&gt;</button>
      </div>
      <div class="weekdays">
        <div>一</div><div>二</div><div>三</div><div>四</div><div>五</div><div>六</div><div>日</div>
      </div>
      <div class="days-grid" id="daysGrid"></div>
    </div>
  </div>

  <!-- 详情弹窗 -->
  <div class="modal" id="detailModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalDateTitle">2026-01-01 竞对酒店活动</h2>
        <span class="close-btn" id="closeModal">&times;</span>
      </div>
      <div id="detailList"></div>
    </div>
  </div>

  <script>
    // ======================
    // 1. 模拟数据（实际应从钉钉AI表格获取）
    // ======================
    // 格式：key = "YYYY-MM-DD"
    const mockData = {
      "2026-01-01": [
        { type: "own", rate: 50 },
        { type: "competitor", rate: 30, details: [
          { hotel: "华美达", activities: { "City Event": 2, "展览": 1 } },
          { hotel: "希尔顿", activities: { "演唱会": 1 } }
        ]},
        { type: "business", rate: 20 }
      ],
      "2026-01-02": [
        { type: "own", rate: 70 },
        { type: "competitor", rate: 40, details: [
          { hotel: "香格里拉", activities: { "会议": 3 } }
        ]}
      ],
      "2026-01-15": [
        { type: "own", rate: 90 },
        { type: "competitor", rate: 60, details: [
          { hotel: "万豪", activities: { "展览": 2, "City Event": 1 } },
          { hotel: "凯悦", activities: { "会议": 1, "演唱会": 1 } }
        ]}
      ]
      // 你可以在这里添加更多日期数据
    };

    // ======================
    // 2. 日历逻辑
    // ======================
    let currentDate = new Date(); // 当前显示的月份

    function renderCalendar(date) {
      const year = date.getFullYear();
      const month = date.getMonth();

      // 更新标题
      document.getElementById("currentMonth").textContent = ` $ {year}年 $ {month + 1}月`;

      // 获取第一天是星期几（0=周日, 1=周一...）
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      // 计算上个月天数（用于补全第一周）
      const prevMonthDays = new Date(year, month, 0).getDate();

      const grid = document.getElementById("daysGrid");
      grid.innerHTML = "";

      // 上个月末尾几天
      for (let i = firstDay === 0 ? 6 : firstDay - 1; i > 0; i--) {
        const day = prevMonthDays - i + 1;
        const cell = createDayCell(day, true);
        grid.appendChild(cell);
      }

      // 本月天数
      const today = new Date();
      for (let day = 1; day <= daysInMonth; day++) {
        const isToday = 
          day === today.getDate() &&
          month === today.getMonth() &&
          year === today.getFullYear();
        const cell = createDayCell(day, false, isToday, year, month + 1, day);
        grid.appendChild(cell);
      }

      // 下个月开头几天（补足6行）
      const totalCells = grid.children.length;
      const nextDays = 42 - totalCells; // 6*7=42
      for (let day = 1; day <= nextDays; day++) {
        const cell = createDayCell(day, true);
        grid.appendChild(cell);
      }
    }

    function createDayCell(day, isOtherMonth, isToday = false, year, month, date) {
      const cell = document.createElement("div");
      cell.className = "day-cell";
      if (isOtherMonth) cell.classList.add("other-month");
      if (isToday) cell.classList.add("today");

      const dayNum = document.createElement("div");
      dayNum.className = "day-number";
      dayNum.textContent = day;
      cell.appendChild(dayNum);

      if (!isOtherMonth && year && month && date) {
        const dateKey = ` $ {year}- $ {String(month).padStart(2, '0')}- $ {String(date).padStart(2, '0')}`;
        const dayData = mockData[dateKey] || [];

        dayData.forEach(item => {
          const tag = document.createElement("div");
          tag.className = "rate-tag";
          if (item.type === "own") {
            tag.classList.add("own-hotel");
            tag.textContent = `本店  $ {item.rate}%`;
          } else if (item.type === "competitor") {
            tag.classList.add("competitor");
            tag.textContent = `竞对  $ {item.rate}%`;
            tag.onclick = () => showDetail(dateKey, item.details);
          } else if (item.type === "business") {
            tag.classList.add("business");
            tag.textContent = `商圈  $ {item.rate}%`;
          }
          cell.appendChild(tag);
        });
      }

      return cell;
    }

    // ======================
    // 3. 事件绑定
    // ======================
    document.getElementById("prevMonth").onclick = () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar(currentDate);
    };
    document.getElementById("nextMonth").onclick = () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar(currentDate);
    };

    // ======================
    // 4. 弹窗逻辑
    // ======================
    function showDetail(date, details) {
      document.getElementById("modalDateTitle").textContent = ` $ {date} 竞对酒店活动`;
      const detailList = document.getElementById("detailList");
      detailList.innerHTML = "";

      details.forEach(hotel => {
        const item = document.createElement("div");
        item.className = "detail-item";
        
        const name = document.createElement("div");
        name.className = "hotel-name";
        name.textContent = hotel.hotel;
        item.appendChild(name);

        const acts = document.createElement("div");
        acts.className = "activity-list";
        let actText = "";
        for (const [type, count] of Object.entries(hotel.activities)) {
          actText += ` $ {type}:  $ {count}场\n`;
        }
        acts.textContent = actText.trim();
        item.appendChild(acts);

        detailList.appendChild(item);
      });

      document.getElementById("detailModal").style.display = "block";
    }

    document.getElementById("closeModal").onclick = () => {
      document.getElementById("detailModal").style.display = "none";
    };
    document.getElementById("detailModal").onclick = (e) => {
      if (e.target === document.getElementById("detailModal")) {
        document.getElementById("detailModal").style.display = "none";
      }
    };

    // ======================
    // 5. 初始化
    // ======================
    renderCalendar(currentDate);
  </script>
</body>
</html>
